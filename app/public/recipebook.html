<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <title>
            Recipe Book
        </title>

        <style>

        </style>
    </head>

    <body>

        <nav>
            <a href = "./index.html">Home</a>
            <a href = "./login.html">Login</a>
            <a href = "./rec.html">Get Recommendations</a>
            <a href = "./pantry.html">Pantry</a>
            <a href = "./shopping.html">Shopping List</a>
            <a href = "./recipebook.html">Recipe Book</a>
        </nav>
        <button id="show-btn">
            Show Saved Recipes
        </button>

        <button id="delete-entry">
            Delete Recipe
        </button>

        <div>
            askjdnakjsndkjasndkjanskdjnasdnaksndkasjndasd<span id="dots">...</span>
            <span id="more">i express to you my condolences for your tragic loss. i can't begin
                to imagine the immense pain u=you must feel. i want you to know that 
                i'm here if you need anything. Anything at all, you just call me.
            </span>
            
        </div>
        <button id="read"> 
            Read More
        </button>
        <div>
            To Be Cooked
            <button id="toggle">See more</button>
            <ul id="recipe">

            </ul>

        </div>

        <div>
            Liked
            <button id="toggle_liked">See more</button>
            <ul id="recipe_liked">

            </ul>

        </div>

        <script>
            let recipe_ul = document.getElementById("recipe");
            let show_btn = document.getElementById("show-btn");
            let delete_btn = document.getElementById("delete-entry");
            let see_btn = document.getElementById("toggle");
            let see_liked_btn = document.getElementById("toggle_liked");
            let liked_ul = document.getElementById("recipe_liked");
            

            let dots = document.getElementById("dots");
            let more = document.getElementById("more");
            let read_btn = document.getElementById("read");
            more.style.display = "none";

            read_btn.addEventListener("click", () => {
                console.log(dots.style.display);
                if (dots.style.display === "none")
                {
                    console.log("if");
                    dots.style.display = "inline";
                    read_btn.textContent = "Read More";
                    more.style.display = "none"
            
                    
                }
                else
                {
                    console.log("else");
                    dots.style.display = "none";
                    read_btn.textContent = "Read Less";
                    more.style.display = "inline"
                    
                    
                }



                    
            });
            show_btn.addEventListener("click", () => {
                fetch("/saved")
                .then((response) => {
                    response.json()
                    .then((body) => {
                        //recipe_ul.style.display = "none";
                        //liked_ul.style.display = "none"
                        //console.log(body.rows.length);
                        //console.log(body.rows[3].id);
                        for (let i = 0; i < body.rows.length; i++)
                        {
                            console.log(body.rows[i].recipe_info.label);
                            if (body.rows[i].folder_name === "To Be Cooked")
                            {
                                let li = document.createElement("li");
                                recipe.append(li);
                                li.textContent = body.rows[i].recipe_info.label;
                                console.log(li.textContent);
                                let cb = document.createElement("input");
                                li.append(cb);
                                cb.type = "checkbox";
                                cb.name = "delete-cb";
                                cb.value = body.rows[i].id;
                            }
                            
                        }
                        
                        for (let i = 0; i < body.rows.length; i++)
                        {
                            //console.log(body.rows[i].recipe.label);
                            if (body.rows[i].folder_name === "Liked")
                            {
                                let li = document.createElement("li");
                                liked_ul.append(li);
                                li.textContent = body.rows[i].recipe_info.label;
                                console.log(li.textContent);
                                let cb = document.createElement("input");
                                li.append(cb);
                                cb.type = "checkbox";
                                cb.name = "delete-cb";
                                cb.value = body.rows[i].id;
                            }
                            
                        }
                    });
            });

            
            });

            delete_btn.addEventListener("click", () => {
                let cb = document.getElementsByName("delete-cb");
                let q_str = ``;
                for (let i = 0; i < cb.length ; i++)
                {
                    if (cb[i].checked)
                    {
                        q_str += `${cb[i].value},`;
                    }
                }
                console.log(q_str);
                fetch(`/delete?q=${q_str}`, { method: 'DELETE'})
                .then((response) => {
                    response.text()
                    .then((body) => {
                        //console.log(body);
                    });
                });
            });
            
            see_btn.addEventListener("click", () => {
                //console.log()
                if (recipe_ul.style.display === "none")
                {
                    recipe_ul.style.display = "inline";
                }
                else
                {
                    recipe_ul.style.display = "none";
                }
                

            });

            see_liked_btn.addEventListener("click", () => {
                if (liked_ul.style.display === "none")
                {
                    liked_ul.style.display = "inline";
                }
                else
                {
                    liked_ul.style.display = "none";
                }
            });
        </script>
    </body>
</html>